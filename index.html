<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‹è€…è£è€€çš®è‚¤æŸ¥è¯¢å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 1200px;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .search-section {
            padding: 40px;
            background: #f8f9fa;
        }
        
        .search-box {
            display: flex;
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-btn, .copy-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .search-btn:hover, .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .loading.show {
            display: block;
        }
        
        .results {
            padding: 40px;
            display: none;
        }
        
        .results.show {
            display: block;
        }
        
        .player-info {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .player-info h2 {
            color: #333;
            font-size: 1.8em;
            margin-bottom: 20px;
        }
        
        .player-info p {
            color: #666;
            font-size: 1.1em;
            line-height: 1.8;
        }
        
        .skin-category {
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }
        
        .category-header {
            padding: 20px 30px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .category-title {
            font-size: 1.4em;
            font-weight: 600;
        }
        
        .category-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 1.1em;
        }
        
        .skin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .skin-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .skin-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }
        
        .skin-name {
            font-weight: 600;
            color: #333;
            font-size: 1.05em;
        }
        
        .empty-category {
            padding: 40px;
            text-align: center;
            color: #999;
            background: #f8f9fa;
        }
        
        /* åˆ†ç±»é¢œè‰² */
        .rongyao .category-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .zhenpinwushuang .category-header {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        .wushuang .category-header {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        }
        
        .zhenpin .category-header {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        
        .chuanshuo .category-header {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        }

        .remen .category-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .xianding .category-header {
            background: linear-gradient(135deg, #ff9a8b 0%, #fecfef 100%);
        }
        
        .neice .category-header {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        
        .xingyuan .category-header {
            background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
        }
        
        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #4caf50;
            color: white;
            padding: 20px 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            font-size: 1.2em;
            font-weight: 600;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .copy-success.show {
            opacity: 1;
        }
        
        .copy-text {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .copy-text:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        @media (max-width: 768px) {
            .search-box {
                flex-direction: column;
            }
            
            .skin-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ‘‘ ç‹è€…è£è€€çš®è‚¤æŸ¥è¯¢å™¨</h1>
            <p>å‡ºç§Ÿè´¦å·è®¤å‡†å°å®‰ç½‘æ¸¸ï¼Œå¾®ä¿¡:<span class="copy-text" onclick="copyToClipboard('and1230and')" title="ç‚¹å‡»å¤åˆ¶å¾®ä¿¡å·">and1230and</span> QQ:<span class="copy-text" onclick="copyToClipboard('1299841161')" title="ç‚¹å‡»å¤åˆ¶QQå·">1299841161</span></p>
        </div>
        
        <div class="search-section">
            <div class="search-box">
                <input type="text" class="search-input" id="playerIdInput" placeholder="è¯·è¾“å…¥ç‹è€…è¥åœ°ID" />
                <button class="search-btn" id="searchBtn">æŸ¥è¯¢çš®è‚¤</button>
                <button class="copy-btn" id="copyBtn" style="display: none;">ä¸€é”®å¤åˆ¶</button>
            </div>
            <div class="loading" id="loading">
                <p>æ­£åœ¨æŸ¥è¯¢ä¸­ï¼Œè¯·ç¨å€™...</p>
            </div>
        </div>
        
        <div class="results" id="results">
            <div class="player-info" id="playerInfo">
                <h2>æŸ¥è¯¢ç»“æœ</h2>
                <p id="playerIdDisplay"></p>
            </div>
            <div class="skin-categories" id="skinCategories"></div>
        </div>
    </div>
    
    <div class="copy-success" id="copySuccess">å¤åˆ¶æˆåŠŸï¼</div>

    <script>
        // é…ç½®
        const CONFIG = {
            API_ENDPOINT: 'https://yd.sycwy.cn/api/json/yd_h5getheroskinlist.php',
            DEMO_MODE: false,
            API_KEY: 'JcpFBxhBpzauO2KBRHfNOOFYkauHj9Dr'
        };

        // å®šä¹‰çš®è‚¤å­—æ®µ
        const SKIN_FIELDS = ['remen', 'xianding', 'wushuang', 'zhenpin', 'zhenpinwushuang', 'rongyao', 'xingyuan'];

        // çš®è‚¤åˆ†ç±»é…ç½®
        const SKIN_CATEGORIES = [
            { key: 'zhenpinwushuang', title: 'çå“æ— åŒçš®è‚¤', className: 'zhenpinwushuang' },
            { key: 'wushuang', title: 'æ— åŒé™å®šçš®è‚¤', className: 'wushuang' },
            { key: 'zhenpin', title: 'çå“çš®è‚¤', className: 'zhenpin' },
            { key: 'rongyao', title: 'è£è€€å…¸è—çš®è‚¤', className: 'rongyao' },
            { key: 'remen', title: 'çƒ­é—¨çš®è‚¤', className: 'remen' },
            { key: 'xianding', title: 'æ™®é€šé™å®šçš®è‚¤', className: 'xianding' },
            { key: 'xingyuan', title: 'æ˜Ÿå…ƒçš®è‚¤', className: 'xingyuan' }
        ];

        // å…¨å±€å˜é‡å­˜å‚¨å½“å‰æ•°æ®
        let currentPlayerData = null;

        // ç”Ÿæˆç­¾å
        function generateSign(params, apiKey) {
            const queryString = `id=${params.id}&key=${apiKey}`;
            return btoa(queryString);
        }

        // ç”Ÿæˆçš®è‚¤åˆ†ç±»
        function generateSkinCategories(data) {
            const categoriesContainer = document.getElementById('skinCategories');
            categoriesContainer.innerHTML = '';
            
            SKIN_CATEGORIES.forEach(category => {
                let skins = [];
                
                // å¤„ç†APIè¿”å›çš„æ•°æ®
                if (data[category.key] && typeof data[category.key] === 'string') {
                    skins = data[category.key].split(',').map(s => s.trim()).filter(Boolean);
                }
                
                // åªæœ‰åœ¨åˆ†ç±»ä¸‹æœ‰çš®è‚¤æ—¶æ‰æ˜¾ç¤º
                if (skins.length > 0) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = `skin-category ${category.className}`;
                    
                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'category-header';
                    headerDiv.innerHTML = `
                        <div class="category-title">${category.title} (${skins.length})</div>
                    `;
                    categoryDiv.appendChild(headerDiv);
                    
                    const gridDiv = document.createElement('div');
                    gridDiv.className = 'skin-grid';
                    
                    skins.forEach(skinName => {
                        const skinItem = document.createElement('div');
                        skinItem.className = 'skin-item';
                        skinItem.innerHTML = `<div class="skin-name">${skinName}</div>`;
                        gridDiv.appendChild(skinItem);
                    });
                    
                    categoryDiv.appendChild(gridDiv);
                    categoriesContainer.appendChild(categoryDiv);
                }
            });

            // ä¿å­˜å½“å‰æ•°æ®ç”¨äºå¤åˆ¶åŠŸèƒ½
            currentPlayerData = data;
        }

        // è°ƒç”¨çœŸå®API
        async function callRealAPI(playerId) {
            const timestamp = Math.floor(Date.now() / 1000).toString();
            const params = {
                id: playerId,
                timestamp: timestamp,
                key: CONFIG.API_KEY
            };
            
            params.sign = generateSign(params, CONFIG.API_KEY);
            
            // å°è¯•HTTPSç‰ˆæœ¬
            try {
                const response = await fetch(CONFIG.API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                        'Referer': 'https://xh.sycwy.cn/',
                        'Origin': 'https://xh.sycwy.cn'
                    },
                    body: new URLSearchParams(params).toString()
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('ğŸŒ åŸå§‹APIå“åº”:', result);
                
                if (result.code === 200 && result.data) {
                    console.log('âœ… APIæ•°æ®è·å–æˆåŠŸï¼Œè¿”å›çœŸå®æ•°æ®');
                    return result.data;
                } else {
                    throw new Error(result.msg || 'æŸ¥è¯¢å¤±è´¥');
                }
            } catch (error) {
                console.error('HTTPS APIè°ƒç”¨å¤±è´¥ï¼Œå°è¯•HTTPç‰ˆæœ¬:', error);
                
                // é™çº§åˆ°HTTPç‰ˆæœ¬
                try {
                    const httpResponse = await fetch('http://yd.sycwy.cn/api/json/yd_h5getheroskinlist.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                            'Referer': 'http://xh.sycwy.cn/',
                            'Origin': 'http://xh.sycwy.cn'
                        },
                        body: new URLSearchParams(params).toString()
                    });
                    
                    if (!httpResponse.ok) {
                        throw new Error(`HTTP error! status: ${httpResponse.status}`);
                    }
                    
                    const httpResult = await httpResponse.json();
                    console.log('ğŸŒ HTTP APIå“åº”:', httpResult);
                    
                    if (httpResult.code === 200 && httpResult.data) {
                        console.log('âœ… HTTP APIæ•°æ®è·å–æˆåŠŸ');
                        return httpResult.data;
                    } else {
                        throw new Error(httpResult.msg || 'æŸ¥è¯¢å¤±è´¥');
                    }
                } catch (httpError) {
                    console.error('HTTP APIä¹Ÿè°ƒç”¨å¤±è´¥:', httpError);
                    throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•');
                }
            }
        }

        // è®¡ç®—çš®è‚¤æ€»æ•°
        function calculateTotalSkins(data) {
            // ä»APIçš„skin_styleå­—æ®µè·å–æ•°æ®
            let total = data.skin_style?.all || parseInt(data.skinNum) || 0;
            let legendCount = data.skin_style?.chuanshuo || 0;
            
            console.log('çš®è‚¤ç»Ÿè®¡:', {
                total: total,
                legendCount: legendCount,
                skin_style: data.skin_style
            });
            
            return { total, legendCount };
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults(data, playerId) {
            currentPlayerData = data;
            const { total, legendCount } = calculateTotalSkins(data);
            
            console.log('APIè¿”å›çš„æ•°æ®:', data);
            console.log('çš®è‚¤æ€»æ•°:', total, 'ä¼ è¯´çš®è‚¤æ•°:', legendCount);
            
            document.getElementById('playerIdDisplay').innerHTML = `
                ç‹è€…è¥åœ°ID: ${playerId}<br>
                çš®è‚¤æ€»æ•°: ${total}<br>
                ä¼ è¯´çš®è‚¤: ${legendCount}
            `;
            
            generateSkinCategories(data);
            document.getElementById('results').classList.add('show');
            document.getElementById('copyBtn').style.display = 'inline-block';
        }

        // æŸ¥è¯¢ç©å®¶
        async function searchPlayer() {
            const playerId = document.getElementById('playerIdInput').value.trim();
            if (!playerId) {
                alert('è¯·è¾“å…¥ç‹è€…è¥åœ°ID');
                return;
            }
            
            const searchBtn = document.getElementById('searchBtn');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            searchBtn.disabled = true;
            loading.classList.add('show');
            results.classList.remove('show');
            
            try {
                const data = await callRealAPI(playerId);
                displayResults(data, playerId);
            } catch (error) {
                alert('æŸ¥è¯¢å¤±è´¥: ' + error.message);
            } finally {
                searchBtn.disabled = false;
                loading.classList.remove('show');
            }
        }

        // å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                const copySuccess = document.getElementById('copySuccess');
                copySuccess.textContent = `å·²å¤åˆ¶: ${text}`;
                copySuccess.classList.add('show');
                setTimeout(() => {
                    copySuccess.classList.remove('show');
                }, 2000);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                // é™çº§å¤„ç†ï¼šåˆ›å»ºä¸´æ—¶inputå…ƒç´ 
                const tempInput = document.createElement('input');
                tempInput.value = text;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                
                const copySuccess = document.getElementById('copySuccess');
                copySuccess.textContent = `å·²å¤åˆ¶: ${text}`;
                copySuccess.classList.add('show');
                setTimeout(() => {
                    copySuccess.classList.remove('show');
                }, 2000);
            });
        }

        // ç”Ÿæˆå¤åˆ¶æ–‡æœ¬
        function generateCopyText() {
            if (!currentPlayerData) return '';
            
            const copyTexts = [];
            
            SKIN_CATEGORIES.forEach(category => {
                let skins = [];
                
                if (currentPlayerData[category.key] && typeof currentPlayerData[category.key] === 'string') {
                    skins = currentPlayerData[category.key].split(',').map(s => s.trim()).filter(Boolean);
                }
                
                if (skins.length > 0) {
                    copyTexts.push(skins.join(','));
                }
            });
            
            return copyTexts.join(',');
        }

        // å¤åˆ¶ç»“æœ
        function copyResults() {
            const text = generateCopyText();
            if (!text) {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
                return;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                const copySuccess = document.getElementById('copySuccess');
                copySuccess.classList.add('show');
                setTimeout(() => {
                    copySuccess.classList.remove('show');
                }, 2000);
            }).catch(err => {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                console.error('å¤åˆ¶å¤±è´¥:', err);
            });
        }

        // åˆå§‹åŒ–
        function initializePage() {
            document.getElementById('searchBtn').addEventListener('click', searchPlayer);
            document.getElementById('copyBtn').addEventListener('click', copyResults);
            
            document.getElementById('playerIdInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchPlayer();
                }
            });
            
            console.log('ç‹è€…è£è€€çš®è‚¤æŸ¥è¯¢å™¨å·²åŠ è½½å®Œæˆï¼');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>